"use strict";angular.module("mtgEmblemsApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/play/:gameId",{templateUrl:"views/play.html",controller:"HostCtrl"}).when("/watch/:gameId",{templateUrl:"views/watch.html",controller:"HostCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]);var shuffleArray=function(a,b){var c,d,e=a.length,f=null;for(f=b===!1?new Math.seedrandom:new Math.seedrandom(b);e;)d=Math.floor(f()*e--),c=a[e],a[e]=a[d],a[d]=c;return a},makeId=function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b};angular.module("mtgEmblemsApp").controller("MainCtrl",["$scope","$http",function(a,b){var c=null;a.showEmblems=[],a.rounds=0,a.gameId=makeId(5),a.reset=function(){a.showEmblems=[],shuffleArray(a.emblems,!1),a.rounds=0},a.next=function(b,c){var d,e,f=0,g=null;if(g=a.getRandomCard(),(b||g.isPermanent)&&(g.type="permanent"),c?g.isAutomatic=!0:a.rounds++,a.showEmblems.push(g),g.drawOthers>0)for(e=g.drawOthers,d=0;e>d;d++)a.next(!1,!0);if(g.drawOthersAsPermanent>0)for(f=g.drawOthersAsPermanent,d=0;f>d;d++)a.next(!0,!0)},a.getRandomCard=function(){var b=Math.floor(c()*a.emblems.length),d=JSON.parse(JSON.stringify(a.emblems[b]));return d.type="standard",d},b.get("./data/emblems.json").success(function(b){a.emblems=b,shuffleArray(a.emblems,!1),c=new Math.seedrandom}).error(function(){})}]),angular.module("mtgEmblemsApp").controller("AboutCtrl",["$scope",function(){}]),angular.module("mtgEmblemsApp").filter("manaSymbols",["$sce",function(a){return function(b){var c=b.replace(/\{(([0-9BWRUGPSTQXYZHC]+)|INF|Tv[23]|WOld|Slash)\}/g,function(a,b){return'<svg xmlns="http://www.w3.org/2000/svg" class="icon-mana mana-'+b+'"><use xlink:href="#'+b+'"></use></svg>'});return a.trustAsHtml(c)}}]),angular.module("mtgEmblemsApp").controller("HeaderCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("mtgEmblemsApp").controller("HostCtrl",["$scope","$route","$routeParams","$http","$firebase",function(a,b,c,d,e){var f=new Firebase("https://mtg-emblems.firebaseio.com/"+c.gameId),g=(e(f),e(f.child("metadata")).$asObject());g.$bindTo(a,"metadata");var h=null;a.showEmblems=[],a.gameId=c.gameId,d.get("./data/emblems.json").success(function(c){a.emblems=c,g.$loaded().then(function(){angular.isUndefined(a.metadata.rounds)&&(a.metadata.rounds=0,a.metadata.seed=makeId(32)),shuffleArray(a.emblems,a.metadata.seed),h=new Math.seedrandom(a.metadata.seed);for(var c=a.metadata.rounds,d=0;c>d;d++)a.next(!1,!1);g.$watch(function(){0===g.rounds?b.reload():a.next(!1,!1)})})}).error(function(){}),a.reset=function(){a.metadata.rounds=0,a.metadata.seed=makeId(32),a.showEmblems=[],shuffleArray(a.emblems,a.metadata.seed),h=new Math.seedrandom(a.metadata.seed)},a.incrementRounds=function(){a.metadata.rounds++},a.next=function(b,c){var d,e,f=0,g=null;if(g=a.getRandomCard(),(b||g.isPermanent)&&(g.type="permanent"),c&&(g.isAutomatic=!0),a.showEmblems.push(g),g.drawOthers>0)for(e=g.drawOthers,d=0;e>d;d++)a.next(!1,!0);if(g.drawOthersAsPermanent>0)for(f=g.drawOthersAsPermanent,d=0;f>d;d++)a.next(!0,!0)},a.getRandomCard=function(){var b=Math.floor(h()*a.emblems.length),c=JSON.parse(JSON.stringify(a.emblems[b]));return c.type="standard",c}}]),angular.module("mtgEmblemsApp").filter("reverse",function(){return function(a){return angular.isArray(a)?a.slice().reverse():a}}),angular.module("mtgEmblemsApp").filter("italicize",["$sce",function(a){return function(b){var c=b.replace(/\*(.*?)\*/gi,'<span style="font-style: italic">$1</span>');return a.trustAsHtml(c)}}]);