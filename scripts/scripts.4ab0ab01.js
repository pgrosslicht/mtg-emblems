"use strict";angular.module("mtgEmblemsApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/play/:gameId",{templateUrl:"views/play.html",controller:"HostCtrl"}).when("/watch/:gameId",{templateUrl:"views/watch.html",controller:"HostCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]);var shuffleArray=function(e,n){var t,o,a=e.length,i=null;for(i=n===!1?new Math.seedrandom:new Math.seedrandom(n);a;)o=Math.floor(i()*a--),t=e[a],e[a]=e[o],e[o]=t;return e},makeId=function(e){for(var n="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;e>o;o++)n+=t.charAt(Math.floor(Math.random()*t.length));return n};angular.module("mtgEmblemsApp").controller("MainCtrl",["$scope","$http",function(e,n){var t=null;e.showEmblems=[],e.rounds=0,e.gameId=makeId(5),e.reset=function(){e.showEmblems=[],shuffleArray(e.emblems,!1),e.rounds=0},e.next=function(n,t){var o,a,i=0,r=null;if(r=e.getRandomCard(),(n||r.isPermanent)&&(r.type="permanent"),t?r.isAutomatic=!0:e.rounds++,e.showEmblems.push(r),r.drawOthers>0)for(a=r.drawOthers,o=0;a>o;o++)e.next(!1,!0);if(r.drawOthersAsPermanent>0)for(i=r.drawOthersAsPermanent,o=0;i>o;o++)e.next(!0,!0)},e.getRandomCard=function(){var n=Math.floor(t()*e.emblems.length),o=JSON.parse(JSON.stringify(e.emblems[n]));return o.type="standard",o},n.get("./data/emblems.json").success(function(n,o,a,i){e.emblems=n,shuffleArray(e.emblems,!1),t=new Math.seedrandom}).error(function(e,n,t,o){})}]),angular.module("mtgEmblemsApp").controller("AboutCtrl",["$scope",function(e){}]),angular.module("mtgEmblemsApp").filter("manaSymbols",["$sce",function(e){return function(n){var t=n.replace(/\{(([0-9BWRUGPSTQXYZHC]+)|INF|Tv[23]|WOld|Slash)\}/g,function(e,n){return'<svg xmlns="http://www.w3.org/2000/svg" class="icon-mana mana-'+n+'"><use xlink:href="#'+n+'"></use></svg>'});return e.trustAsHtml(t)}}]),angular.module("mtgEmblemsApp").controller("HeaderCtrl",["$scope","$location",function(e,n){e.isActive=function(e){return e===n.path()}}]),angular.module("mtgEmblemsApp").controller("HostCtrl",["$scope","$route","$routeParams","$http","$firebaseObject",function(e,n,t,o,a){var i=new Firebase("https://mtg-emblems.firebaseio.com/"+t.gameId),r=(a(i),a(i.child("metadata")));r.$bindTo(e,"metadata");var d=null;e.showEmblems=[],e.gameId=t.gameId,o.get("./data/emblems.json").success(function(t,o,a,i){e.emblems=t,r.$loaded().then(function(){angular.isUndefined(e.metadata.rounds)&&(e.metadata.rounds=0,e.metadata.seed=makeId(32)),shuffleArray(e.emblems,e.metadata.seed),d=new Math.seedrandom(e.metadata.seed);for(var t=e.metadata.rounds,o=0;t>o;o++)e.next(!1,!1);r.$watch(function(){0===r.rounds?n.reload():e.next(!1,!1)})})}).error(function(e,n,t,o){}),e.reset=function(){e.metadata.rounds=0,e.metadata.seed=makeId(32),e.showEmblems=[],shuffleArray(e.emblems,e.metadata.seed),d=new Math.seedrandom(e.metadata.seed)},e.incrementRounds=function(){e.metadata.rounds++},e.next=function(n,t){var o,a,i=0,r=null;if(r=e.getRandomCard(),(n||r.isPermanent)&&(r.type="permanent"),t&&(r.isAutomatic=!0),e.showEmblems.push(r),r.drawOthers>0)for(a=r.drawOthers,o=0;a>o;o++)e.next(!1,!0);if(r.drawOthersAsPermanent>0)for(i=r.drawOthersAsPermanent,o=0;i>o;o++)e.next(!0,!0)},e.getRandomCard=function(){var n=Math.floor(d()*e.emblems.length),t=JSON.parse(JSON.stringify(e.emblems[n]));return t.type="standard",t}}]),angular.module("mtgEmblemsApp").filter("reverse",function(){return function(e){return angular.isArray(e)?e.slice().reverse():e}}),angular.module("mtgEmblemsApp").filter("italicize",["$sce",function(e){return function(e){var n=e.replace(/\*(.*?)\*/gi,function(e,n){return'<span style="font-style: italic">'+n+"</span>"});return n}}]);